<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScaleX Dashboard</title>

    <link rel="icon" type="image/x-icon" href="./static/icons/favicon.ico">

    <!-- Tailwind -->
    <link href="./static/css/tailwind.css" rel="stylesheet">

    <!-- jQuery (Required for DateRangePicker) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Moment.js -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>

    <!-- DateRangePicker CSS & JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker@3.1.0/daterangepicker.css" />
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1.0/daterangepicker.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- Lucide icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Lucide screenshot of the dashboard -->
    <script src="https://unpkg.com/html-to-image@1.11.11/dist/html-to-image.js"></script>
    <!-- Lucide screenshot into a PDF -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

    <!-- Custom styles -->
    <link rel="stylesheet" href="./static/css/styles.css">


    <!-- Prevent flash -->
    <script>
        window.onload = () => {
            document.body.style.visibility = 'visible';
            if (window.lucide) window.lucide.createIcons();
        };
    </script>
</head>

<body style="visibility:hidden">

    <!-- FIXED HEADER (background capped via inner container) -->
    <!-- <header id="main-header" class="fixed top-0 inset-x-0 z-40 bg-gradient-to-r from-emerald-900 via-gray-900 to-gray-950 shadow-lg"> -->
    <header id="main-header">
        <div class="header-inner">
            <!-- Left: Brand -->
            <div class="flex items-center space-x-3">
                <a href="./dashboard.html">
                    <img src="./static/img/scaletrix-logo.png" alt="Scaletrix.ai Logo" class="logo-img">
                </a>
            </div>

            <!-- Right: app_id + logout -->
            <div class="flex items-center space-x-3">
                <!-- Export dropdown -->
                <div class="export-wrapper">
                    <button id="export-toggle" class="export-button rounded-lg">
                        export
                    </button>
                    <div id="export-menu" class="export-menu hidden">
                        <button class="export-option" data-format="pdf">Export as PDF</button>
                        <button class="export-option" data-format="png">Export as Image</button>
                    </div>
                </div>

                <!-- CLICKABLE CLIENT ID -->
                <span id="client-id-display" class="client-id-text cursor-pointer inline-flex items-center gap-1">
                    <strong style="font-size: 0.9rem;">analytixlabs_main</strong>
                </span>

                <button class="logout-button" onclick="location.href='./index.html'">
                    <i data-lucide="power" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="page">
        <!-- MAIN LAYOUT (centered, max width) -->
        <div class="layout-container">
            <!-- SIDEBAR (full-height column) -->
            <aside class="sidebar box-shadow-cust">
                <nav>
                    <ul class="space-y-3 pt-4">
                        <li class="sidebar-link active">
                            Performance Overview
                        </li>
                        <li class="sidebar-link">
                            Channel &amp; Campaign Analytics
                        </li>
                        <!-- <li class="sidebar-link">
                            Attribution &amp; Signal Health
                        </li>
                        <li class="sidebar-link">
                            Funnel &amp; Lead Journey
                        </li> -->
                    </ul>
                </nav>
            </aside>

            <!-- CONTENT -->
            <main id="main-content" class="main-content">
                <!-- Heading (syncs with sidebar selection) -->
                <h2 id="main-heading" class="text-2xl font-bold">
                    Performance Overview
                </h2>

                <!-- Grouping & Filtering (hidden for now) -->
                <div id="filter-section" class="mt-4 rounded-lg filter-section">
                    <div id="filter-header"
                        class="flex justify-between items-center px-4 py-3 cursor-pointer filter-header"
                        onclick="toggleFilterSection()">
                        <h3 class="text-sm font-semibold text-white filter-title">Grouping and Filtering</h3>
                        <svg id="filter-toggle-arrow" class="filter-arrow" xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>

                    <div id="filter-content" class="hidden p-4 filter-content">
                        <!-- Messages -->
                        <div class="error-message" id="errorMessage"></div>
                        <div class="success-message" id="successMessage"></div>

                        <!-- Date Range Selector -->
                        <div class="date-range-wrapper">
                            <label class="date-range-label">ðŸ“… Select Date Range</label>
                            <input type="text" id="daterangepicker" placeholder="Select date range" />
                        </div>

                        <!-- Action Buttons -->
                        <div class="filter-actions">
                            <button onclick="handleFilterReset()" class="btn btn-secondary">Reset</button>
                            <button onclick="handleFilterSubmit()" class="btn btn-primary">Apply</button>
                        </div>
                    </div>
                </div>

                <!-- KPI CARDS (placeholder) -->
                <div id="kpi-cards" class="kpi-grid mt-4">

                    <!-- Revenue -->
                    <div class="kpi-card kpi-revenue">
                        <div class="kpi-card-header">
                            <span class="kpi-label">Revenue</span>
                            <span id="rev-change" class="kpi-change">--</span>
                        </div>
                        <div class="kpi-main">
                            <div class="kpi-value-wrap">
                                <div id="rev-current" class="kpi-value">--</div>
                                <div id="rev-prev" class="kpi-prev">Prev: --</div>
                            </div>
                            <div class="kpi-chart-wrap">
                                <canvas id="rev-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Spend -->
                    <div class="kpi-card kpi-spend">
                        <div class="kpi-card-header">
                            <span class="kpi-label">Spend</span>
                            <span id="spend-change" class="kpi-change">--</span>
                        </div>
                        <div class="kpi-main">
                            <div class="kpi-value-wrap">
                                <div id="spend-current" class="kpi-value">--</div>
                                <div id="spend-prev" class="kpi-prev">Prev: --</div>
                            </div>
                            <div class="kpi-chart-wrap">
                                <canvas id="spend-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- ROAS -->
                    <div class="kpi-card kpi-roas">
                        <div class="kpi-card-header">
                            <span class="kpi-label">ROAS</span>
                            <span id="roas-change" class="kpi-change">--</span>
                        </div>
                        <div class="kpi-main">
                            <div class="kpi-value-wrap">
                                <div id="roas-current" class="kpi-value">--</div>
                                <div id="roas-prev" class="kpi-prev">Prev: --</div>
                            </div>
                            <div class="kpi-chart-wrap">
                                <canvas id="roas-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- ROI -->
                    <div class="kpi-card kpi-roi">
                        <div class="kpi-card-header">
                            <span class="kpi-label">ROI</span>
                            <span id="roi-change" class="kpi-change">--</span>
                        </div>
                        <div class="kpi-main">
                            <div class="kpi-value-wrap">
                                <div id="roi-current" class="kpi-value">--</div>
                                <div id="roi-prev" class="kpi-prev">Prev: --</div>
                            </div>
                            <div class="kpi-chart-wrap">
                                <canvas id="roi-chart"></canvas>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- SMART ALERTS -->
                <div id="smart-alerts" class="smart-alerts">
                    <h3 class="smart-alerts-title">Smart Alerts</h3>

                    <div class="smart-alerts-grid">

                        <!-- Performance Gain (alert_performance_gain) -->
                        <div id="alert-card-performance-gain" class="alert-card alert-card--positive">
                            <div>
                                <p class="alert-text-label">Performance Gain</p>
                                <p class="alert-text-main">
                                    <span class="alert-main-prefix">ROAS up</span>
                                    <span class="alert-highlight alert-highlight-green alert-main-highlight">
                                        18% MoM
                                    </span>
                                    <span class="alert-main-suffix"></span>
                                </p>
                                <p class="alert-text-sub">
                                    Driven by higher CRM match rate.
                                </p>
                            </div>
                            <div class="alert-symbol alert-symbol--green">
                                â–²
                            </div>
                        </div>

                        <!-- Channel Mix Efficiency (instead of Data Quality) -->
                        <div id="alert-card-channel-mix" class="alert-card alert-card--info">
                            <div>
                                <p class="alert-text-label">Channel Mix Efficiency</p>
                                <p class="alert-text-main">
                                    <span class="alert-main-prefix">Shift</span>
                                    <span class="alert-highlight alert-highlight-sky alert-main-highlight">
                                        10â€“15% budget
                                    </span>
                                    <span class="alert-main-suffix">from Meta to Google</span>
                                </p>
                                <p class="alert-text-sub">
                                    Higher revenue efficiency observed on Google campaigns.
                                </p>
                            </div>
                            <div class="alert-symbol alert-symbol--sky">
                                â˜…
                            </div>
                        </div>

                        <!-- Budget / Risk (alert_budget_reallocation) -->
                        <div id="alert-card-budget-risk" class="alert-card alert-card--warning">
                            <div>
                                <p class="alert-text-label">Budget / Risk</p>
                                <p class="alert-text-main">
                                    <span class="alert-main-prefix">Google spend up</span>
                                    <span class="alert-highlight alert-highlight-amber alert-main-highlight">
                                        25%
                                    </span>
                                    <span class="alert-main-suffix">but ROAS flat</span>
                                </p>
                                <p class="alert-text-sub">
                                    Review Google non-brand campaigns for wasted spend.
                                </p>
                            </div>
                            <div class="alert-symbol alert-symbol--amber">
                                âš 
                            </div>
                        </div>

                    </div>
                </div>


                <!-- DETAIL BLOCK -->
                <div id="detail-section" class="mt-4 rounded-lg shadow-lg p-6 box-shadow-cust">
                    <h3 class="text-xl font-semibold mb-4">Detailed View</h3>
                    <!-- <p class="text-gray-300 mb-4 text-sm">
                        Note: These container represent the main KPI overview. <br>
                        This will be displayed metrics like: Spend â†’ Revenue â†’ ROI â†’ ROAS | CAC | Pipeline | LTV:CAC |
                        Attribution Accuracy | Top Channels by ROAS
                    </p> -->
                    <div id="detail-charts" class="grid gap-4">
                        <!-- JS: insert canvases / SVGs / tables here -->
                    </div>
                </div>



            </main>
        </div>
        <footer id="main-footer">
            <div class="footer-inner">
                <p>Â© 2025 <strong>Scaletrix.ai</strong>. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Chart fullscreen modal -->
    <div id="chart-modal" class="chart-modal hidden">
        <div class="chart-modal-inner">
            <div class="chart-modal-header">
                <!-- <span id="chart-modal-title" class="chart-modal-title">Chart</span> -->
                <h3 id="chart-modal-title">Chart</h3>
                <p id="chart-modal-subtitle" class="text-sm text-slate-300"></p>
                <div class="chart-modal-actions">
                    <button id="chart-modal-download-png" class="chart-modal-btn">
                        PNG
                    </button>
                    <button id="chart-modal-download-pdf" class="chart-modal-btn">
                        PDF
                    </button>
                    <button id="chart-modal-close" class="chart-modal-btn chart-modal-btn-close">
                        âœ•
                    </button>
                </div>
            </div>
            <div class="chart-modal-body">
                <canvas id="chart-modal-canvas"></canvas>
            </div>
        </div>
    </div>

    <!-- Loader -->
    <div id="loader" class="hidden fixed inset-0 bg-gray-950 flex items-center justify-center z-50"
        style="background-color: rgba(3, 7, 18, 0.80);">
        <div class="animate-spin h-16 w-16 border-4 border-t-emerald-500 border-gray-300 rounded-full"></div>
    </div>

    <!-- CLIENT PROFILE / ADS CONNECTION MODAL -->
    <div id="client-modal-backdrop" class="client-modal-backdrop hidden">
        <div class="client-modal-panel">
            <!-- Close button -->
            <button id="client-modal-close" class="client-modal-close" aria-label="Close">
                âœ•
            </button>

            <h2 class="client-modal-title">Client Profile</h2>
            <p class="client-modal-subtitle">
                View workspace details and connect your ad accounts.
            </p>

            <!-- Client Info Section -->
            <div class="client-modal-section">
                <h3 class="client-modal-section-title">Client Info</h3>
                <dl class="client-modal-info-grid">
                    <div>
                        <dt>Client ID</dt>
                        <dd id="client-modal-client-id">--</dd>
                    </div>
                    <div>
                        <dt>Email</dt>
                        <dd id="client-modal-client-email">client@example.com</dd>
                    </div>
                </dl>
            </div>

            <!-- Ads Connections Section -->
            <div class="client-modal-section">
                <h3 class="client-modal-section-title">Ads Connections</h3>

                <a id="google-ads-link" href="#" class="client-modal-btn client-modal-btn-google"
                    data-base-url="https://scalex-ads-connector-ohkoqzgrzq-el.a.run.app/oauth/google/start"
                    target="_blank" rel="noopener noreferrer">Connect Google Ads</a>

                <a id="meta-ads-link" href="#" class="client-modal-btn client-modal-btn-meta"
                    data-base-url="https://scalex-ads-connector-ohkoqzgrzq-el.a.run.app/oauth/meta/start"
                    target="_blank" rel="noopener noreferrer">Connect Meta Ads</a>

                <!-- <button id="google-ads-connect" class="client-modal-btn client-modal-btn-google">
                    <a id="google-ads-link" href="#"
                        data-base-url="https://scalex-ads-connector-ohkoqzgrzq-el.a.run.app/oauth/google/start"
                        target="_blank" rel="noopener noreferrer">Connect
                        Google
                        Ads</a>
                </button>

                <button id="meta-ads-connect" class="client-modal-btn client-modal-btn-meta">
                    <a id="meta-ads-link" href="#"
                        data-base-url="https://scalex-ads-connector-ohkoqzgrzq-el.a.run.app/oauth/meta/start"
                        target="_blank" rel="noopener noreferrer">Connect
                        Meta Ads</a>
                </button> -->

                <p class="client-modal-helper">
                    When you click these buttons, weâ€™ll open a secure window to connect your
                    Google / Meta ads account using OAuth.
                </p>
            </div>
        </div>
    </div>

    <!-- Layout JS -->
    <script src="./static/js/dashboard_layout.js"></script>
    <script src="./static/js/dashboard_charts.js"></script>
    <script src="./static/js/dashboard_chart_api.js"></script>
</body>

</html>